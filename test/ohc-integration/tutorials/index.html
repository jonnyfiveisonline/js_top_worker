<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>JTW Library Tutorials</title>
  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', system-ui, sans-serif; background: #0d1117; color: #c9d1d9; padding: 40px 24px; line-height: 1.5; }
    .container { max-width: 960px; margin: 0 auto; }
    h1 { color: #f0f6fc; font-size: 28px; margin-bottom: 4px; }
    .subtitle { color: #8b949e; font-size: 15px; margin-bottom: 32px; }
    .subtitle a { color: #58a6ff; text-decoration: none; }
    .subtitle a:hover { text-decoration: underline; }

    .lib-group { margin-bottom: 32px; }
    .lib-group h2 { font-size: 16px; color: #f0f6fc; margin-bottom: 10px; padding-bottom: 6px; border-bottom: 1px solid #21262d; }
    .lib-group .desc { font-size: 13px; color: #8b949e; margin-bottom: 10px; }

    .version-cards { display: flex; flex-wrap: wrap; gap: 8px; }
    .version-card { display: block; padding: 8px 14px; background: #161b22; border: 1px solid #30363d; border-radius: 8px; text-decoration: none; color: #c9d1d9; font-size: 14px; transition: border-color 0.2s, background 0.2s; }
    .version-card:hover { border-color: #58a6ff; background: #1c2128; }
    .version-card .ver { font-family: 'SF Mono', 'Fira Code', monospace; color: #d2a8ff; font-weight: 600; }
    .version-card .steps { font-size: 11px; color: #8b949e; margin-top: 2px; }
  </style>
</head>
<body>
  <div class="container">
    <h1>JTW Library Tutorials</h1>
    <p class="subtitle">Interactive OCaml tutorials built from ohc JTW output &mdash; <a href="../runner.html">test runner</a></p>
    <div id="groups"></div>
  </div>

  <script type="module">
    import { TUTORIALS } from './test-defs.js';

    // Group tutorials by library name
    const libs = {};
    for (const [key, t] of Object.entries(TUTORIALS)) {
      if (!libs[t.name]) libs[t.name] = { name: t.name, description: t.description, versions: [] };
      const stepCount = t.sections.reduce((n, s) => n + s.steps.length, 0);
      libs[t.name].versions.push({ key, version: t.version, steps: stepCount });
    }

    // Sort libraries alphabetically, versions by semver
    const sorted = Object.values(libs).sort((a, b) => a.name.localeCompare(b.name));
    for (const lib of sorted) {
      lib.versions.sort((a, b) => a.version.localeCompare(b.version, undefined, { numeric: true }));
    }

    const container = document.getElementById('groups');
    for (const lib of sorted) {
      const g = document.createElement('div');
      g.className = 'lib-group';
      let html = `<h2>${lib.name}</h2>`;
      html += `<div class="desc">${lib.description}</div>`;
      html += '<div class="version-cards">';
      for (const v of lib.versions) {
        html += `<a class="version-card" href="tutorial.html?pkg=${encodeURIComponent(v.key)}">`;
        html += `<div class="ver">${v.version}</div>`;
        html += `<div class="steps">${v.steps} steps</div>`;
        html += `</a>`;
      }
      html += '</div>';
      g.innerHTML = html;
      container.appendChild(g);
    }
  </script>
</body>
</html>
